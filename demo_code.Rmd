---
title: "pamlApps demo code"
author: "Janet Young\n"
date: "`r Sys.Date()`"
output: github_document
always_allow_html: true
---
    
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(here)
library(tidyverse)
library(janitor)
library(patchwork)
library(kableExtra)
source("parseAndPlotPAML_functions.R")
```

# sitewise PAML

Read a model 8 rst file:
```{r}
ACE2_sitePAML_rstFile <- "data/paml_version_4.10.6/example_ACE2/M8_initOmega0.4_codonModel2/rst"

## get the BEB table as a data.frame
ACE2siteResults <- parseRSTfile(ACE2_sitePAML_rstFile) # %>% 
   #  as_tibble()
```

look at that table for sites where BEB >= 0.90

```{r}
ACE2siteResults[which(ACE2siteResults[,"prob_class11_omega_4.69678"] >= 0.90),]
```


plot BEB mean dN/dS estimate

```{r, fig.height=4, fig.width=9}
plotOmegas(ACE2siteResults, 
           title="ACE2 model 8 BEB mean dN/dS estimates", 
           highlightHighBEB=TRUE, 
           highBEBthreshold=0.90, 
           highBEBcolor="red")
```


plot BEB mean dN/dS estimate in a visually unusual way, where bars all start at dN/dS=1. Our tetherin collaborators liked seeing the results this way but it is not intuitive: makes it look like most sites have dN/dS=1.

```{r, fig.height=4, fig.width=9}
plotOmegas(ACE2siteResults, 
           title="ACE2 primates: model 8 BEB mean dN/dS estimates", 
           highlightHighBEB=TRUE, 
           highBEBthreshold=0.90, 
           highBEBcolor="red", 
           yAxisCenterAtNeutral=TRUE)
```


plot BEB probabilities of being in the positively selected class

```{r, fig.height=4, fig.width=9}
plotProbs(ACE2siteResults, 
          title="ACE2 primates: M8 BEB probabilities of positive selection",
          addThresholdLine=TRUE, 
          threshold=0.90, 
          thresholdLineColor="red",
          highlightHighBEB=TRUE, 
          highBEBthreshold=0.90, 
          highBEBcolor="blue")
```



# Finished

show R version used, and package versions

```{r sessionInfo}
sessionInfo()
```


